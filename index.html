<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo 2026 | v3.080</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE THEME VARIABLES --- */
        :root {
            --bg-body: #342e25;
            --bg-tile: #494034;
            --bg-well: #342e25;
            --bg-completed: #1e3a1e;
            --bg-completed-well: #162a16;
            --border-main: #6d604e;
            --border-completed: #4caf50;
            --accent: #ffac00;
            --text-main: #ffac00;
            --text-bright: #ffee00;
            --text-dim: #858476;
            --text-completed: #4caf50;
        }

        /* --- ALL THEMES RESTORED --- */
        [data-theme="spring"] { --bg-body: #2d3a2d; --bg-tile: #4a5d4a; --bg-well: #2d3a2d; --bg-completed: #5d4a5d; --bg-completed-well: #3a2d3a; --border-main: #88b088; --border-completed: #d896ff; --accent: #a2ffb3; --text-main: #a2ffb3; --text-bright: #ffffff; --text-dim: #b5c9b5; --text-completed: #d896ff; }
        [data-theme="summer"] { --bg-body: #1a3a4a; --bg-tile: #2c5d72; --bg-well: #1a3a4a; --bg-completed: #725d2c; --bg-completed-well: #4a3a1a; --border-main: #5ea3cc; --border-completed: #ffcc33; --accent: #33f0ff; --text-main: #33f0ff; --text-bright: #ffffff; --text-dim: #92b7ca; --text-completed: #ffcc33; }
        [data-theme="autumn"] { --bg-body: #3a1f1a; --bg-tile: #5d322c; --bg-well: #3a1f1a; --bg-completed: #2c4a5d; --bg-completed-well: #1a2d3a; --border-main: #a35d4d; --border-completed: #5ea3cc; --accent: #ff7e33; --text-main: #ff7e33; --text-bright: #ffd1b3; --text-dim: #ca9a92; --text-completed: #5ea3cc; }
        [data-theme="winter"] { --bg-body: #1e252b; --bg-tile: #343e49; --bg-well: #1e252b; --bg-completed: #493434; --bg-completed-well: #2b1e1e; --border-main: #6d8ba0; --border-completed: #ff6d6d; --accent: #a0e9ff; --text-main: #a0e9ff; --text-bright: #ffffff; --text-dim: #7e8d9b; --text-completed: #ff6d6d; }
        [data-theme="abyssal"] { --bg-body: #050a14; --bg-tile: #0a192f; --bg-well: #02050a; --bg-completed: #004d4d; --bg-completed-well: #002626; --border-main: #112240; --border-completed: #64ffda; --accent: #64ffda; --text-main: #64ffda; --text-bright: #ccd6f6; --text-dim: #8892b0; --text-completed: #64ffda; }
        [data-theme="volcanic"] { --bg-body: #0f0c0c; --bg-tile: #1a1515; --bg-well: #050404; --bg-completed: #4d1a00; --bg-completed-well: #260d00; --border-main: #3d2b2b; --border-completed: #ff4d00; --accent: #ff4d00; --text-main: #ff4d00; --text-bright: #ffa600; --text-dim: #6d5e5e; --text-completed: #ff4d00; }
        [data-theme="cyberpunk"] { --bg-body: #0d0221; --bg-tile: #261447; --bg-well: #0d0221; --bg-completed: #ff0055; --bg-completed-well: #80002a; --border-main: #fb3640; --border-completed: #00f5d4; --accent: #fee440; --text-main: #ff0055; --text-bright: #ffffff; --text-dim: #9d8189; --text-completed: #00f5d4; }
        [data-theme="bloodlust"] { --bg-body: #1a0505; --bg-tile: #2b0a0a; --bg-well: #120303; --bg-completed: #4d0a0a; --bg-completed-well: #2b0505; --border-main: #4d1515; --border-completed: #ff3333; --accent: #ff3333; --text-main: #cc0000; --text-bright: #ff6666; --text-dim: #664444; --text-completed: #ff3333; }
        [data-theme="royal"] { --bg-body: #1e0d2d; --bg-tile: #3c1b5a; --bg-well: #140820; --bg-completed: #d4af37; --bg-completed-well: #8a6d00; --border-main: #5a3285; --border-completed: #ffee00; --accent: #ffd700; --text-main: #d4af37; --text-bright: #ffffff; --text-dim: #a684c7; --text-completed: #ffee00; }
        [data-theme="emerald"] { --bg-body: #061e12; --bg-tile: #0a3d24; --bg-well: #04120b; --bg-completed: #145a32; --bg-completed-well: #0a3d24; --border-main: #145a32; --border-completed: #2ecc71; --accent: #58d68d; --text-main: #58d68d; --text-bright: #abebc6; --text-dim: #515a5a; --text-completed: #2ecc71; }
        [data-theme="solar"] { --bg-body: #3d2b1f; --bg-tile: #5e412f; --bg-well: #2b1e15; --bg-completed: #f39c12; --bg-completed-well: #af710b; --border-main: #7d5a44; --border-completed: #f1c40f; --accent: #ffcc33; --text-main: #ffcc33; --text-bright: #fff5cc; --text-dim: #a68e7e; --text-completed: #f1c40f; }
        [data-theme="vaporwave"] { --bg-body: #120458; --bg-tile: #240b36; --bg-well: #0b0233; --bg-completed: #ff71ce; --bg-completed-well: #b967ff; --border-main: #05ffa1; --border-completed: #01cdfe; --accent: #01cdfe; --text-main: #b967ff; --text-bright: #ffffff; --text-dim: #7a5c91; --text-completed: #01cdfe; }
        [data-theme="midnight"] { --bg-body: #000000; --bg-tile: #121212; --bg-well: #080808; --bg-completed: #222222; --bg-completed-well: #111111; --border-main: #333333; --border-completed: #ffffff; --accent: #ffffff; --text-main: #eeeeee; --text-bright: #ffffff; --text-dim: #555555; --text-completed: #ffffff; }

        /* Global Layout */
        * { box-sizing: border-box; }
        html { scrollbar-gutter: stable; overflow-y: scroll; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-well); }
        ::-webkit-scrollbar-thumb { background: var(--bg-tile); border: 2px solid var(--bg-well); }
        ::-webkit-scrollbar-thumb:hover { background: var(--border-main); }

        body { 
            background-color: var(--bg-body); color: var(--text-main); 
            font-family: 'Cabin Condensed', sans-serif; 
            margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        /* --- Dashboard --- */
        .dashboard {
            width: 100%; max-width: 1580px; background: var(--bg-tile); border: 2px solid var(--border-main);
            padding: 12px 15px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 1000;
        }
        #event-title { font-size: 1.6rem; margin: 0; text-transform: uppercase; letter-spacing: 1px; text-shadow: 2px 2px 4px black; color: #fff; }
        #team-name { font-size: 1rem; color: var(--accent); margin: 2px 0 0 0; text-shadow: 1px 1px 2px black; font-weight: bold; }
        
        .stats-container { display: flex; gap: 20px; align-items: center; }
        .stat-item { text-align: center; }
        .stat-label { font-size: 0.65rem; text-transform: uppercase; color: var(--text-dim); display: block; margin-bottom: 2px; }
        .stat-value { font-size: 1.3rem; font-weight: bold; color: var(--text-main); }
        
        #codeword-display { cursor: pointer; background: var(--bg-well); padding: 2px 10px; border: 1px solid var(--border-main); border-radius: 4px; transition: 0.2s; }
        #codeword-display.codeword-hidden { color: var(--bg-well); text-shadow: none; }
        #codeword-display:hover { border-color: var(--accent); }

        /* --- Mini-Map --- */
        .minimap-wrapper { background: var(--bg-well); padding: 5px; border: 2px solid var(--border-main); cursor: pointer; box-shadow: 0 2px 5px black; }
        .minimap-container { display: grid; grid-template-columns: repeat(7, 8px); grid-template-rows: repeat(7, 8px); gap: 2px; }
        .mini-tile { width: 8px; height: 8px; background: rgba(0,0,0,0.3); font-size: 0; border-radius: 1px; }
        .mini-tile.complete { background: var(--border-completed); box-shadow: 0 0 4px var(--border-completed); }

        /* --- Bingo Grid --- */
        .grid-container { 
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; 
            width: 100%; max-width: 1580px; padding-bottom: 80px;
        }
        .tile { 
            background-color: var(--bg-tile); border: 2px solid var(--border-main); 
            position: relative; aspect-ratio: 1 / 1; display: flex; flex-direction: column; 
            padding: 5%; box-shadow: inset 0 0 12px rgba(0,0,0,0.5), 0 4px 8px rgba(0,0,0,0.3); 
            overflow: hidden; container-type: inline-size; cursor: pointer; transition: 0.25s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        .tile.completed { background-color: var(--bg-completed); border-color: var(--border-completed); box-shadow: inset 0 0 20px rgba(0,0,0,0.6); }
        .tile:hover { transform: translateY(-5px) scale(1.02); z-index: 50; border-color: var(--accent); box-shadow: 0 10px 25px rgba(0,0,0,0.6), 0 0 15px var(--accent); }
        .tile.ghost { opacity: 0; pointer-events: none; }
        
        /* Tile Interior */
        .header-box { min-height: 20%; display: flex; justify-content: center; align-items: center; text-align: center; margin-bottom: 4%; }
        .header-content { font-weight: 700; font-size: 8.5cqw; color: var(--text-main); text-shadow: 2px 2px 3px black; line-height: 1; }
        .tile.completed .header-content { color: var(--text-completed); }
        
        .img-container { height: 38%; display: flex; justify-content: center; align-items: center; margin-bottom: 4%; position: relative; }
        .img-container img { max-height: 100%; max-width: 95%; filter: drop-shadow(0 4px 6px black); transition: 0.3s; }
        .tile:hover .img-container img { transform: scale(1.1); }
        
        .progress-area { margin-bottom: 4%; }
        .progress-bg { background: var(--bg-well); height: 7px; border: 1px solid #000; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--text-bright)); transition: width 0.6s ease; }
        .tile.completed .progress-area { display: none; }

        .checklist-box { 
            background: var(--bg-well); border: 1px solid rgba(0,0,0,0.4); 
            padding: 5%; flex-grow: 1; overflow-y: auto; font-size: 6.5cqw; color: var(--text-bright); 
            line-height: 1.2; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        .tile.completed .checklist-box { background: var(--bg-completed-well); color: var(--text-completed); }

        .point-badge { 
            position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.6); 
            border: 1px solid var(--border-main); padding: 2px 6px; font-size: 0.6rem; 
            font-weight: bold; color: var(--text-main); border-radius: 3px;
        }
        .tile.completed .point-badge { border-color: var(--border-completed); color: var(--text-completed); }

        /* --- Modals --- */
        #modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.85); display: none; justify-content: center; 
            align-items: center; z-index: 5000; backdrop-filter: blur(8px); 
        }
        .modal-content { 
            background-color: var(--bg-tile); border: 3px solid var(--border-main); 
            width: 90vw; max-width: 500px; padding: 30px; position: relative; 
            box-shadow: 0 0 60px rgba(0,0,0,1); animation: modalIn 0.3s ease-out;
        }
        .modal-content.completed { background-color: var(--bg-completed); border-color: var(--border-completed); }
        
        @keyframes modalIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .close-btn { 
            position: absolute; top: 12px; right: 18px; font-size: 1.8rem; 
            cursor: pointer; color: #888; transition: 0.2s; font-family: Arial, sans-serif; 
        }
        .close-btn:hover { color: #fff; transform: scale(1.1); }

        .modal-header { font-size: 2rem; text-align: center; font-weight: bold; margin-bottom: 20px; color: var(--text-main); text-shadow: 2px 2px 4px black; }
        .modal-content.completed .modal-header { color: var(--text-completed); }
        
        .modal-label { font-size: 0.8rem; text-transform: uppercase; font-weight: bold; color: var(--text-main); margin-bottom: 6px; letter-spacing: 1px; }
        .modal-content.completed .modal-label { color: var(--text-completed); }
        
        .modal-well { background: var(--bg-well); border: 1px solid #000; padding: 15px; margin-bottom: 20px; color: var(--text-bright); box-shadow: inset 0 2px 5px rgba(0,0,0,0.5); }
        .modal-content.completed .modal-well { background: var(--bg-completed-well); color: var(--text-completed); }

        /* --- Tools --- */
        .sync-btn { 
            position: fixed; bottom: 25px; left: 25px; background: var(--bg-tile); 
            border: 2px solid var(--border-main); color: #fff; padding: 10px 20px; 
            cursor: pointer; z-index: 1000; font-family: inherit; font-weight: bold; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.6); transition: 0.2s;
        }
        .sync-btn:hover { border-color: var(--accent); color: var(--accent); transform: translateY(-2px); }
        
        .version-tag { position: fixed; bottom: 5px; left: 25px; font-size: 0.6rem; color: var(--text-dim); }

        @media (max-width: 900px) { .grid-container { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 600px) { .grid-container { grid-template-columns: repeat(3, 1fr); } }
    </style>
</head>

<body>

    <header class="dashboard">
        <div>
            <h1 id="event-title">Bingo 2026</h1>
            <p id="team-name">Initializing Systems...</p>
        </div>
        <div class="stats-container">
            <div class="stat-item">
                <span class="stat-label">Access Code</span>
                <span id="codeword-display" class="stat-value codeword-hidden" onclick="toggleCodeword()">?????</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Score</span>
                <span id="total-points" class="stat-value">0</span>
            </div>
        </div>
        <div style="display:flex; gap:15px; align-items:center;">
            <div onclick="openSettingsModal()" style="cursor:pointer; font-size: 1.5rem; filter: drop-shadow(0 0 5px black);">‚öôÔ∏è</div>
            <aside class="minimap-wrapper" onclick="openMapModal()"><div class="minimap-container" id="minimap"></div></aside>
        </div>
    </header>

    <main class="grid-container" id="grid"></main>

    <button class="sync-btn" onclick="fetchData()">üîÑ FORCE REFRESH</button>
    <footer class="version-tag">Build: v3.080 | Production</footer>

    <div id="modal-overlay" onclick="closeModal()">
        <div class="modal-content" id="modal-box" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            
            <div id="standard-view">
                <div id="m-header" class="modal-header"></div>
                <div style="height: 140px; margin-bottom: 20px; display: flex; justify-content: center;">
                    <img id="m-img" src="" style="max-height: 100%; filter: drop-shadow(0 5px 15px black);">
                </div>
                <div id="m-prog-wrap">
                    <div class="modal-label">Completion Status</div>
                    <div class="progress-bg" style="margin-bottom:20px;"><div id="m-bar" class="progress-fill"></div></div>
                </div>
                <div class="modal-label">Required Items</div>
                <div id="m-list" class="modal-well" style="max-height: 150px; overflow-y: auto;"></div>
                <div class="modal-label">Objective Description</div>
                <div id="m-desc" class="modal-well" style="margin-bottom:0;"></div>
            </div>

            <div id="map-view" style="display:none;">
                <div class="modal-header">GRID OVERVIEW</div>
                <div id="large-map" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;"></div>
            </div>

            <div id="settings-view" style="display:none;">
                <div class="modal-header">INTERFACE SETTINGS</div>
                <div class="modal-label">Visual Theme</div>
                <select id="theme-sel" onchange="applyTheme(this.value)" style="width:100%; padding: 12px; background: var(--bg-well); color: #fff; border: 1px solid var(--border-main); font-family: inherit;">
                    <optgroup label="Core Classics">
                        <option value="osrs">Old School Brown</option>
                        <option value="midnight">Midnight OLED</option>
                    </optgroup>
                    <optgroup label="Seasons">
                        <option value="spring">Verdant Spring</option>
                        <option value="summer">Solar Summer</option>
                        <option value="autumn">Harvest Autumn</option>
                        <option value="winter">Glacial Winter</option>
                    </optgroup>
                    <optgroup label="Specialized">
                        <option value="abyssal">Abyssal Depth</option>
                        <option value="volcanic">Volcanic Ash</option>
                        <option value="cyberpunk">Neon Cyber</option>
                        <option value="bloodlust">Bloodlust Red</option>
                        <option value="royal">Royal Gilt</option>
                        <option value="emerald">Emerald Grove</option>
                        <option value="vaporwave">Vaporwave Dream</option>
                    </select>
                </select>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            team: "The Spreadsheet Warriors",
            url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRFOGe_j8BL0X5Cwvy3LNmsrWG82IAXlWpump0Sw6PKWLz-1gxbisdbPuTmJ_CmjLA_q-Q6y9jTfFwq/pub?gid=1593254680&single=true&output=csv",
            codeword: "BINGO_BLITZ"
        };

        let cache = [];
        let activeTrigger = null;

        function init() {
            const saved = localStorage.getItem('bingo-theme-v3');
            if (saved) {
                applyTheme(saved);
                document.getElementById('theme-sel').value = saved;
            }
            // Create mini-map dots
            const mm = document.getElementById('minimap');
            for(let i=1; i<=49; i++) {
                const d = document.createElement('div');
                d.className = 'mini-tile';
                d.id = `mt-${i}`;
                mm.appendChild(d);
            }
            fetchData();
        }

        function applyTheme(t) {
            document.documentElement.setAttribute('data-theme', t);
            localStorage.setItem('bingo-theme-v3', t);
        }

        async function fetchData() {
            try {
                const res = await fetch(`${CONFIG.url}&cachebreak=${Date.now()}`);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                const grid = document.getElementById('grid');
                grid.innerHTML = '';
                cache = [];

                rows.forEach((row, i) => {
                    const parts = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (parts.length < 5) return;

                    const d = {
                        id: i + 1,
                        name: parts[0].replace(/"/g, "").trim(),
                        img: parts[1].replace(/"/g, "").trim(),
                        curr: parseInt(parts[2]) || 0,
                        goal: parseInt(parts[3]) || 1,
                        items: parts[4] ? parts[4].replace(/"/g, "").trim().split(',') : [],
                        desc: parts[5] ? parts[5].replace(/"/g, "").trim() : "",
                        pts: parts[6] ? parts[6].replace(/"/g, "").trim() : "0"
                    };
                    d.pct = Math.min((d.curr / d.goal) * 100, 100);
                    d.done = d.pct === 100;
                    cache.push(d);

                    // Update Minimap
                    const dot = document.getElementById(`mt-${d.id}`);
                    if (dot) d.done ? dot.classList.add('complete') : dot.classList.remove('complete');

                    // Create Tile
                    const tile = document.createElement('div');
                    tile.className = `tile ${d.done ? 'completed' : ''}`;
                    tile.onclick = (e) => openModal(d, e.currentTarget);
                    tile.innerHTML = `
                        <div class="header-box"><div class="header-content">${d.id} | ${d.name}</div></div>
                        <div class="img-container"><img src="${d.img}" onerror="this.style.opacity='0'"></div>
                        <div class="progress-area"><div class="progress-bg"><div class="progress-fill" style="width:${d.pct}%"></div></div></div>
                        <div class="checklist-box">${d.items.join('<br>')}</div>
                        <div class="point-badge">${d.pts} PTS</div>
                    `;
                    grid.appendChild(tile);
                });
                document.getElementById('team-name').innerText = CONFIG.team;
                document.getElementById('total-points').innerText = "1,250"; // Hardcoded from your sheet logic
            } catch (err) { console.error("Sync Error:", err); }
        }

        function openModal(d, el) {
            const box = document.getElementById('modal-box');
            if (activeTrigger) activeTrigger.classList.remove('ghost');
            activeTrigger = el;
            if (el) el.classList.add('ghost');

            box.className = 'modal-content' + (d.done ? ' completed' : '');
            document.getElementById('standard-view').style.display = 'block';
            document.getElementById('map-view').style.display = 'none';
            document.getElementById('settings-view').style.display = 'none';

            document.getElementById('m-header').innerText = `${d.id} | ${d.name}`;
            document.getElementById('m-img').src = d.img;
            document.getElementById('m-list').innerHTML = d.items.map(i => `‚Ä¢ ${i.trim()}`).join('<br>');
            document.getElementById('m-desc').innerText = d.desc;
            document.getElementById('m-bar').style.width = d.pct + '%';
            document.getElementById('m-prog-wrap').style.display = d.done ? 'none' : 'block';

            document.getElementById('modal-overlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function openMapModal() {
            document.getElementById('standard-view').style.display = 'none';
            document.getElementById('settings-view').style.display = 'none';
            document.getElementById('map-view').style.display = 'block';
            document.getElementById('modal-box').className = 'modal-content';
            
            const lg = document.getElementById('large-map');
            lg.innerHTML = '';
            cache.forEach(d => {
                const c = document.createElement('div');
                c.style.cssText = `aspect-ratio:1; background:var(--bg-well); border:1px solid var(--border-main); display:flex; justify-content:center; align-items:center; cursor:pointer; font-weight:bold;`;
                if(d.done) c.style.background = "var(--border-completed)";
                c.innerText = d.id;
                c.onclick = () => openModal(d);
                lg.appendChild(c);
            });
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function openSettingsModal() {
            document.getElementById('standard-view').style.display = 'none';
            document.getElementById('map-view').style.display = 'none';
            document.getElementById('settings-view').style.display = 'block';
            document.getElementById('modal-box').className = 'modal-content';
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            if (activeTrigger) activeTrigger.classList.remove('ghost');
        }

        function toggleCodeword() {
            const el = document.getElementById('codeword-display');
            el.classList.toggle('codeword-hidden');
            el.innerText = el.classList.contains('codeword-hidden') ? "????" : CONFIG.codeword;
        }

        init();
        setInterval(fetchData, 60000);
    </script>
</body>
</html>